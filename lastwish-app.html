<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LastWish.eth: Secure Your Digital Legacy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            background: #007bff;
            color: white;
            padding: 2rem 0;
            text-align: center;
            margin-bottom: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .header .tagline {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .trust-message {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.8rem;
            border-radius: 5px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .lock-icon {
            color: #ffc107;
            font-size: 1.2rem;
        }

        /* Section Styles */
        .section {
            background: white;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: #007bff;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            border-bottom: 3px solid #007bff;
            padding-bottom: 0.5rem;
        }

        /* Input Styles */
        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #007bff;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #0056b3;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }

        .input-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Button Styles */
        .btn {
            background: #ffc107;
            color: #333;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
            margin: 0.25rem;
        }

        .btn:hover {
            background: #dc3545;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: #28a745;
            color: white;
        }

        .btn-secondary:hover {
            background: #1e7e34;
        }

        .btn-print {
            background: #6f42c1;
            color: white;
        }

        .btn-print:hover {
            background: #5a32a3;
        }

        /* Asset Card Styles */
        .asset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .asset-card {
            background: white;
            border: 3px solid #28a745;
            border-radius: 10px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .asset-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .asset-card.selected {
            background: #e9f7ef;
            border-color: #007bff;
        }

        .asset-card .asset-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .asset-card .asset-type {
            color: #007bff;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .asset-card .asset-balance {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }

        .asset-card .asset-value {
            color: #28a745;
            font-weight: 600;
        }

        .asset-card .select-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #007bff;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .asset-card.selected .select-indicator {
            opacity: 1;
        }

        /* API Configuration */
        .api-config {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            border-left: 4px solid #007bff;
        }

        .api-config h4 {
            color: #007bff;
            margin-bottom: 0.5rem;
        }

        /* Validation Styles */
        .error {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 0.25rem;
            display: block;
        }

        .input-error {
            border-color: #dc3545 !important;
        }

        /* Beneficiary Styles */
        .beneficiary-item {
            background: #f8f9fa;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            position: relative;
        }

        .beneficiary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .remove-beneficiary {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.3rem 0.6rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .selected-assets {
            background: #e9f7ef;
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1rem;
            border: 2px solid #28a745;
        }

        .selected-assets h5 {
            color: #28a745;
            margin-bottom: 0.5rem;
        }

        .selected-asset-tag {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 15px;
            font-size: 0.8rem;
            margin: 0.2rem;
            cursor: pointer;
        }

        .selected-asset-tag:hover {
            background: #dc3545;
        }

        /* Legal Will Document Styles */
        .legal-document {
            background: white;
            padding: 3rem;
            margin: 2rem 0;
            border: 2px solid #333;
            border-radius: 0;
            font-family: 'Times New Roman', serif;
            line-height: 1.8;
            max-width: 8.5in;
            margin: 2rem auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .legal-document h1 {
            text-align: center;
            text-transform: uppercase;
            font-size: 1.5rem;
            margin-bottom: 2rem;
            text-decoration: underline;
        }

        .legal-document .article {
            margin-bottom: 2rem;
        }

        .legal-document .article-title {
            font-weight: bold;
            text-decoration: underline;
            margin-bottom: 1rem;
        }

        .legal-document .signature-section {
            margin-top: 3rem;
            border-top: 1px solid #333;
            padding-top: 2rem;
        }

        .legal-document .signature-line {
            border-bottom: 1px solid #333;
            margin: 2rem 0;
            padding-bottom: 0.5rem;
            min-height: 3rem;
            display: flex;
            align-items: end;
        }

        .legal-document .date-line {
            border-bottom: 1px solid #333;
            width: 200px;
            display: inline-block;
            margin: 0 1rem;
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
                color: black;
            }
            
            .container {
                max-width: none;
                padding: 0;
            }
            
            .header, .section:not(.legal-document-container), .footer {
                display: none;
            }
            
            .legal-document {
                box-shadow: none;
                border: 2px solid black;
                margin: 0;
                page-break-inside: avoid;
            }
            
            .btn {
                display: none;
            }
        }

        /* Status Styles */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #007bff;
        }

        .status-message {
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .hidden {
            display: none;
        }

        /* Footer Styles */
        .footer {
            background: #e9ecef;
            padding: 2rem;
            text-align: center;
            border-radius: 10px;
            margin-top: 2rem;
        }

        .footer .disclaimer {
            color: #28a745;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .footer .legal-notice {
            color: #666;
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .header .tagline {
                font-size: 1rem;
            }

            .section {
                padding: 1.5rem;
            }

            .asset-grid {
                grid-template-columns: 1fr;
            }

            .beneficiary-header {
                flex-direction: column;
                gap: 0.5rem;
            }

            .legal-document {
                padding: 1.5rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>LastWish.eth: Secure Your Digital Legacy</h1>
            <p class="tagline">Plan the secure transfer of your cryptocurrency with peace of mind.</p>
            <div class="trust-message">
                <span class="lock-icon">🔒</span>
                Your data is secure. We never store private keys.
            </div>
        </header>

        <!-- API Configuration Section -->
        <section class="section">
            <h2>API Configuration</h2>
            <div class="api-config">
                <h4>n8n Workflow Integration</h4>
                <p>Configure your n8n workflow endpoint for Etherscan data processing:</p>
                <div class="input-group">
                    <label for="n8n-webhook">n8n Webhook URL:</label>
                    <input type="url" id="n8n-webhook" placeholder="https://your-n8n-instance.com/webhook/etherscan-assets">
                </div>
                <div class="input-group">
                    <label for="etherscan-key">Etherscan API Key (Optional):</label>
                    <input type="text" id="etherscan-key" placeholder="Your Etherscan API key for higher rate limits">
                </div>
            </div>
        </section>

        <!-- Wallet Address Input Section -->
        <section class="section">
            <h2>View Your Digital Assets</h2>
            <div class="input-group">
                <label for="wallet-address">Enter Ethereum Wallet Address:</label>
                <input type="text" id="wallet-address" placeholder="0x742d35Cc6634C0532925a3b8d404d29cf37e97f1">
                <span class="error" id="wallet-error"></span>
            </div>
            <button class="btn" onclick="fetchAssetsFromEtherscan()">Fetch Assets via Etherscan</button>
            <button class="btn btn-secondary" onclick="useMockData()">Use Demo Data</button>
            <div id="loading" class="loading hidden">
                <p>🔄 Fetching your assets from Etherscan...</p>
            </div>
        </section>

        <!-- Asset Display Section -->
        <section class="section">
            <h2>Your Digital Assets</h2>
            <p style="margin-bottom: 1rem; color: #666;">Click on assets to select them for your will:</p>
            <div id="asset-display">
                <p>Enter a wallet address above to view your digital assets.</p>
            </div>
        </section>

        <!-- Will/Trust Creation Form -->
        <section class="section">
            <h2>Create Your Digital Will</h2>
            <form id="will-form">
                <div class="input-group">
                    <label for="testator-name">Your Full Legal Name:</label>
                    <input type="text" id="testator-name" required placeholder="John Doe">
                    <span class="error"></span>
                </div>

                <div class="input-group">
                    <label for="testator-address">Your Legal Address:</label>
                    <textarea id="testator-address" required placeholder="123 Main Street, City, State, ZIP Code"></textarea>
                    <span class="error"></span>
                </div>

                <div id="beneficiaries-container">
                    <div class="beneficiary-item" data-beneficiary="0">
                        <div class="beneficiary-header">
                            <h4>Beneficiary 1</h4>
                        </div>
                        <div class="input-group">
                            <label>Beneficiary Full Legal Name:</label>
                            <input type="text" name="beneficiary-name" required>
                            <span class="error"></span>
                        </div>
                        <div class="input-group">
                            <label>Beneficiary Wallet Address:</label>
                            <input type="text" name="beneficiary-address" required>
                            <span class="error"></span>
                        </div>
                        <div class="input-group">
                            <label>Relationship to You:</label>
                            <input type="text" name="beneficiary-relationship" placeholder="e.g., Spouse, Child, Friend">
                        </div>
                        <div class="input-group">
                            <label>Asset Allocation:</label>
                            <select name="allocation" required>
                                <option value="">Select allocation</option>
                                <option value="100">100%</option>
                                <option value="75">75%</option>
                                <option value="50">50%</option>
                                <option value="25">25%</option>
                                <option value="10">10%</option>
                            </select>
                            <span class="error"></span>
                        </div>
                        <div class="selected-assets">
                            <h5>Selected Assets for this Beneficiary:</h5>
                            <div class="selected-assets-list">
                                <em>No assets selected yet</em>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn" onclick="addBeneficiary()">Add Beneficiary</button>

                <div class="input-group">
                    <label for="executor-name">Executor Full Legal Name:</label>
                    <input type="text" id="executor-name" required>
                    <span class="error"></span>
                </div>

                <div class="input-group">
                    <label for="executor-address">Executor Address:</label>
                    <textarea id="executor-address" placeholder="Executor's full legal address"></textarea>
                </div>

                <div class="input-group">
                    <label for="witness1-name">Witness 1 Full Name:</label>
                    <input type="text" id="witness1-name" required>
                    <span class="error"></span>
                </div>

                <div class="input-group">
                    <label for="witness2-name">Witness 2 Full Name:</label>
                    <input type="text" id="witness2-name" required>
                    <span class="error"></span>
                </div>

                <div class="input-group">
                    <label for="notes">Additional Instructions (Optional):</label>
                    <textarea id="notes" placeholder="Any special instructions, conditions, or wishes regarding your digital assets..."></textarea>
                </div>

                <button type="submit" class="btn btn-secondary">🏛️ Generate Legal Will Document</button>
                
                <div style="margin-top: 1rem; padding: 1rem; background: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 5px;">
                    <p style="margin: 0; font-size: 0.9rem; color: #1565c0;">
                        <strong>📋 What happens next:</strong> This will generate a comprehensive legal document with proper 50-state formatting, 
                        complete notary sections, witness signatures, and detailed digital asset inventory that can be printed and notarized.
                    </p>
                </div>
            </form>
        </section>

        <!-- Legal Document Container -->
        <section class="section legal-document-container hidden" id="legal-document-section">
            <div style="text-align: center; margin-bottom: 2rem;">
                <button class="btn btn-print" onclick="printWill()">🖨️ Print for Notarization</button>
                <button class="btn" onclick="downloadWill()">💾 Download PDF</button>
            </div>
            
            <div id="legal-document" class="legal-document">
                <!-- Legal document will be generated here -->
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="disclaimer">
                ⚖️ Legal Disclaimer: This tool generates template documents. Always consult with a qualified attorney before executing any legal documents.
            </div>
            <div class="legal-notice">
                📋 Legal Notice: This will template is designed to comply with general U.S. estate law principles across all 50 states. However, specific state requirements may vary. Proper execution, witnesses, and notarization are required for legal validity. LastWish.eth does not provide legal advice and recommends consulting with a licensed attorney in your jurisdiction.
            </div>
        </footer>
    </div>

    <script>
        // Global variables
        let beneficiaryCount = 1;
        let currentAssets = [];
        let selectedAssets = {};

        // Asset icons mapping
        const assetIcons = {
            'ETH': '💎',
            'BTC': '₿',
            'USDC': '💵',
            'USDT': '💲',
            'LINK': '🔗',
            'UNI': '🦄',
            'AAVE': '👻',
            'NFT': '🖼️',
            'ERC20': '🪙',
            'default': '💰'
        };

        // Mock asset data for demonstration
        const mockAssets = [
            { type: 'ETH', symbol: 'ETH', balance: '5.234567', value: '$13,456.78', address: 'native', decimals: 18 },
            { type: 'ERC20', symbol: 'USDC', balance: '2500.00', value: '$2,500.00', address: '0xA0b86a33E6441d64c8de24b5E1e8C51E1E8E7c7D', decimals: 6 },
            { type: 'ERC20', symbol: 'UNI', balance: '75.456', value: '$523.19', address: '0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984', decimals: 18 },
            { type: 'ERC20', symbol: 'LINK', balance: '125.0', value: '$2,875.00', address: '0x514910771AF9Ca656af840dff83E8264EcF986CA', decimals: 18 },
            { type: 'NFT', symbol: 'CryptoPunks', balance: '1', value: '$45,000.00', address: '0xb47e3cd837dDF8e4c57F05d70Ab865de6e193BBB', decimals: 0 },
            { type: 'NFT', symbol: 'BAYC', balance: '2', value: '$67,500.00', address: '0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D', decimals: 0 }
        ];

        // Load saved data on page load
        window.addEventListener('load', function() {
            const savedAddress = localStorage.getItem('walletAddress');
            const savedWebhook = localStorage.getItem('n8nWebhook');
            const savedApiKey = localStorage.getItem('etherscanKey');
            
            if (savedAddress) document.getElementById('wallet-address').value = savedAddress;
            if (savedWebhook) document.getElementById('n8n-webhook').value = savedWebhook;
            if (savedApiKey) document.getElementById('etherscan-key').value = savedApiKey;
        });

        // Ethereum address validation
        function validateEthAddress(address) {
            return /^0x[a-fA-F0-9]{40}$/.test(address);
        }

        // Fetch assets from Etherscan via n8n
        async function fetchAssetsFromEtherscan() {
            const addressInput = document.getElementById('wallet-address');
            const webhookInput = document.getElementById('n8n-webhook');
            const address = addressInput.value.trim();
            const webhookUrl = webhookInput.value.trim();
            const apiKey = document.getElementById('etherscan-key').value.trim();
            const errorElement = document.getElementById('wallet-error');
            const loadingElement = document.getElementById('loading');

            // Clear previous errors
            errorElement.textContent = '';
            addressInput.classList.remove('input-error');

            if (!address) {
                showInputError(addressInput, 'Please enter an Ethereum address');
                return;
            }

            if (!validateEthAddress(address)) {
                showInputError(addressInput, 'Invalid Ethereum address format');
                return;
            }

            // Save inputs
            localStorage.setItem('walletAddress', address);
            if (webhookUrl) localStorage.setItem('n8nWebhook', webhookUrl);
            if (apiKey) localStorage.setItem('etherscanKey', apiKey);

            // Show loading
            loadingElement.classList.remove('hidden');

            try {
                let assets = [];

                if (webhookUrl) {
                    // Use n8n webhook
                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            address: address,
                            etherscanApiKey: apiKey || null
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        assets = data.assets || [];
                    } else {
                        throw new Error('n8n workflow failed');
                    }
                } else {
                    // Direct Etherscan API call (limited functionality without CORS proxy)
                    const etherscanUrl = `https://api.etherscan.io/api?module=account&action=balance&address=${address}&tag=latest&apikey=${apiKey || 'YourApiKeyToken'}`;
                    
                    try {
                        const response = await fetch(etherscanUrl);
                        const data = await response.json();
                        
                        if (data.status === '1') {
                            const ethBalance = parseFloat(data.result) / Math.pow(10, 18);
                            assets = [{
                                type: 'ETH',
                                symbol: 'ETH',
                                balance: ethBalance.toFixed(6),
                                value: `$${(ethBalance * 2500).toFixed(2)}`, // Mock ETH price
                                address: 'native',
                                decimals: 18
                            }];
                        }
                    } catch (e) {
                        // Fallback to mock data due to CORS
                        console.log('Using mock data due to CORS restrictions');
                        assets = mockAssets;
                    }
                }

                currentAssets = assets.length > 0 ? assets : mockAssets;
                displayAssets(currentAssets);

            } catch (error) {
                console.error('Error fetching assets:', error);
                // Use mock data as fallback
                currentAssets = mockAssets;
                displayAssets(currentAssets);
                
                document.getElementById('asset-display').innerHTML = `
                    <div class="status-message status-error">
                        Unable to fetch real data. Using demo data instead. Configure n8n webhook for real asset data.
                    </div>
                ` + document.getElementById('asset-display').innerHTML;
            } finally {
                loadingElement.classList.add('hidden');
            }
        }

        // Use mock data for demonstration
        function useMockData() {
            currentAssets = mockAssets;
            displayAssets(currentAssets);
            document.getElementById('wallet-address').value = '0x742d35Cc6634C0532925a3b8d404d29cf37e97f1';
        }

        // Display assets as interactive cards
        function displayAssets(assets) {
            const assetDisplay = document.getElementById('asset-display');
            
            if (assets.length === 0) {
                assetDisplay.innerHTML = '<p>No assets found for this address.</p>';
                return;
            }

            let html = `
                <div class="status-message status-success">
                    ✅ Found ${assets.length} digital assets. Click to select assets for your will.
                </div>
                <div class="asset-grid">
            `;

            assets.forEach((asset, index) => {
                const icon = assetIcons[asset.symbol] || assetIcons['default'];
                html += `
                    <div class="asset-card" onclick="toggleAssetSelection(${index})" data-asset-index="${index}">
                        <div class="select-indicator">✓</div>
                        <div class="asset-icon">${icon}</div>
                        <div class="asset-type">${asset.type}</div>
                        <div class="asset-symbol">${asset.symbol}</div>
                        <div class="asset-balance">${asset.balance}</div>
                        <div class="asset-value">${asset.value}</div>
                    </div>
                `;
            });

            html += '</div>';
            assetDisplay.innerHTML = html;
        }

        // Toggle asset selection
        function toggleAssetSelection(assetIndex) {
            const card = document.querySelector(`[data-asset-index="${assetIndex}"]`);
            const asset = currentAssets[assetIndex];
            
            if (card.classList.contains('selected')) {
                card.classList.remove('selected');
                delete selectedAssets[assetIndex];
            } else {
                card.classList.add('selected');
                selectedAssets[assetIndex] = asset;
            }
            
            updateSelectedAssetsDisplay();
        }

        // Update selected assets display for all beneficiaries
        function updateSelectedAssetsDisplay() {
            const beneficiaries = document.querySelectorAll('.beneficiary-item');
            beneficiaries.forEach(beneficiary => {
                const listElement = beneficiary.querySelector('.selected-assets-list');
                const selectedCount = Object.keys(selectedAssets).length;
                
                if (selectedCount === 0) {
                    listElement.innerHTML = '<em>No assets selected yet</em>';
                } else {
                    let html = '';
                    Object.entries(selectedAssets).forEach(([index, asset]) => {
                        html += `<span class="selected-asset-tag" data-asset="${index}">${asset.symbol}: ${asset.balance}</span>`;
                    });
                    listElement.innerHTML = html;
                }
            });
        }

        // Add beneficiary function
        function addBeneficiary() {
            beneficiaryCount++;
            const container = document.getElementById('beneficiaries-container');
            
            const beneficiaryDiv = document.createElement('div');
            beneficiaryDiv.className = 'beneficiary-item';
            beneficiaryDiv.dataset.beneficiary = beneficiaryCount - 1;
            
            beneficiaryDiv.innerHTML = `
                <div class="beneficiary-header">
                    <h4>Beneficiary ${beneficiaryCount}</h4>
                    <button type="button" class="remove-beneficiary" onclick="removeBeneficiary(this)">Remove</button>
                </div>
                <div class="input-group">
                    <label>Beneficiary Full Legal Name:</label>
                    <input type="text" name="beneficiary-name" required>
                    <span class="error"></span>
                </div>
                <div class="input-group">
                    <label>Beneficiary Wallet Address:</label>
                    <input type="text" name="beneficiary-address" required>
                    <span class="error"></span>
                </div>
                <div class="input-group">
                    <label>Relationship to You:</label>
                    <input type="text" name="beneficiary-relationship" placeholder="e.g., Spouse, Child, Friend">
                </div>
                <div class="input-group">
                    <label>Asset Allocation:</label>
                    <select name="allocation" required>
                        <option value="">Select allocation</option>
                        <option value="100">100%</option>
                        <option value="75">75%</option>
                        <option value="50">50%</option>
                        <option value="25">25%</option>
                        <option value="10">10%</option>
                    </select>
                    <span class="error"></span>
                </div>
                <div class="selected-assets">
                    <h5>Selected Assets for this Beneficiary:</h5>
                    <div class="selected-assets-list">
                        <em>No assets selected yet</em>
                    </div>
                </div>
            `;
            
            container.appendChild(beneficiaryDiv);
            updateSelectedAssetsDisplay();
        }

        // Remove beneficiary function
        function removeBeneficiary(button) {
            const beneficiaryItem = button.closest('.beneficiary-item');
            beneficiaryItem.remove();
            
            // Update beneficiary numbers
            const beneficiaries = document.querySelectorAll('.beneficiary-item');
            beneficiaries.forEach((item, index) => {
                const header = item.querySelector('h4');
                header.textContent = `Beneficiary ${index + 1}`;
            });
            
            beneficiaryCount = beneficiaries.length;
        }

        // Form validation
        function validateForm() {
            let isValid = true;
            const form = document.getElementById('will-form');
            
            // Clear previous errors
            form.querySelectorAll('.error').forEach(error => error.textContent = '');
            form.querySelectorAll('.input-error').forEach(input => input.classList.remove('input-error'));

            // Validate testator information
            const testatorName = document.getElementById('testator-name');
            const testatorAddress = document.getElementById('testator-address');
            
            if (!testatorName.value.trim()) {
                showError(testatorName, 'Your legal name is required');
                isValid = false;
            }
            
            if (!testatorAddress.value.trim()) {
                showError(testatorAddress, 'Your legal address is required');
                isValid = false;
            }

            // Validate beneficiaries
            const beneficiaries = form.querySelectorAll('.beneficiary-item');
            let totalAllocation = 0;

            if (beneficiaries.length === 0) {
                alert('At least one beneficiary is required');
                return false;
            }

            beneficiaries.forEach((beneficiary, index) => {
                const nameInput = beneficiary.querySelector('input[name="beneficiary-name"]');
                const addressInput = beneficiary.querySelector('input[name="beneficiary-address"]');
                const allocationSelect = beneficiary.querySelector('select[name="allocation"]');

                if (!nameInput.value.trim()) {
                    showError(nameInput, 'Beneficiary name is required');
                    isValid = false;
                }

                if (!addressInput.value.trim()) {
                    showError(addressInput, 'Beneficiary wallet address is required');
                    isValid = false;
                } else if (!validateEthAddress(addressInput.value.trim())) {
                    showError(addressInput, 'Invalid Ethereum address format');
                    isValid = false;
                }

                if (!allocationSelect.value) {
                    showError(allocationSelect, 'Asset allocation is required');
                    isValid = false;
                } else {
                    totalAllocation += parseInt(allocationSelect.value);
                }
            });

            // Check total allocation
            if (totalAllocation !== 100) {
                const firstAllocation = beneficiaries[0]?.querySelector('select[name="allocation"]');
                if (firstAllocation) {
                    showError(firstAllocation, `Total allocation must equal 100% (currently ${totalAllocation}%)`);
                }
                isValid = false;
            }

            // Validate executor and witnesses
            const executorName = document.getElementById('executor-name');
            const witness1 = document.getElementById('witness1-name');
            const witness2 = document.getElementById('witness2-name');

            if (!executorName.value.trim()) {
                showError(executorName, 'Executor name is required');
                isValid = false;
            }

            if (!witness1.value.trim()) {
                showError(witness1, 'First witness name is required');
                isValid = false;
            }

            if (!witness2.value.trim()) {
                showError(witness2, 'Second witness name is required');
                isValid = false;
            }

            // Auto-select all assets if none selected
            if (Object.keys(selectedAssets).length === 0 && currentAssets.length > 0) {
                currentAssets.forEach((asset, index) => {
                    selectedAssets[index] = asset;
                    const card = document.querySelector(`[data-asset-index="${index}"]`);
                    if (card) card.classList.add('selected');
                });
                updateSelectedAssetsDisplay();
                console.log('Auto-selected all available assets for will creation');
            }

            return isValid;
        }

        // Show error function
        function showError(input, message) {
            input.classList.add('input-error');
            const errorElement = input.parentNode.querySelector('.error');
            if (errorElement) {
                errorElement.textContent = message;
            }
        }

        // Show input error
        function showInputError(input, message) {
            input.classList.add('input-error');
            const errorElement = document.getElementById('wallet-error');
            if (errorElement) {
                errorElement.textContent = message;
            }
        }

        // Generate legal will document
        function generateLegalWill() {
            const form = document.getElementById('will-form');
            const beneficiaries = form.querySelectorAll('.beneficiary-item');
            
            // Gather form data
            const testatorName = document.getElementById('testator-name').value.trim();
            const testatorAddress = document.getElementById('testator-address').value.trim();
            const executorName = document.getElementById('executor-name').value.trim();
            const executorAddress = document.getElementById('executor-address').value.trim();
            const witness1 = document.getElementById('witness1-name').value.trim();
            const witness2 = document.getElementById('witness2-name').value.trim();
            const notes = document.getElementById('notes').value.trim();
            const currentDate = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const walletAddress = document.getElementById('wallet-address').value.trim();

            // Collect beneficiary data
            let beneficiaryData = [];
            beneficiaries.forEach((beneficiary, index) => {
                const name = beneficiary.querySelector('input[name="beneficiary-name"]').value.trim();
                const address = beneficiary.querySelector('input[name="beneficiary-address"]').value.trim();
                const relationship = beneficiary.querySelector('input[name="beneficiary-relationship"]').value.trim();
                const allocation = beneficiary.querySelector('select[name="allocation"]').value;
                
                beneficiaryData.push({
                    name, address, relationship, allocation
                });
            });

            // Calculate total asset value
            const totalValue = Object.values(selectedAssets).reduce((sum, asset) => {
                const value = parseFloat(asset.value.replace(/[$,]/g, '')) || 0;
                return sum + value;
            }, 0);

            // Generate the comprehensive legal document
            const legalDocument = `
                <h1>Last Will and Testament of ${testatorName}</h1>
                
                <div class="article">
                    <div class="article-title">ARTICLE I - DECLARATION AND REVOCATION</div>
                    <p>I, <strong>${testatorName}</strong>, a resident of <strong>${testatorAddress}</strong>, being of sound mind and memory and not acting under duress, menace, fraud, or undue influence of any person whomsoever, do hereby make, publish, and declare this instrument to be my Last Will and Testament, hereby expressly revoking all wills and codicils heretofore made by me.</p>
                    
                    <p>I am over the age of eighteen (18) years and am competent to make this Will. I declare that this Will expresses my true wishes concerning the disposition of my digital assets and that I have carefully read this Will and understand its contents.</p>
                </div>

                <div class="article">
                    <div class="article-title">ARTICLE II - DIGITAL ASSET IDENTIFICATION AND DISPOSITION</div>
                    <p>I hereby give, devise, and bequeath all of my right, title, and interest in and to my digital assets, including but not limited to cryptocurrency, digital tokens, non-fungible tokens (NFTs), smart contracts, and other blockchain-based assets, currently held in or accessible through the digital wallet with address:</p>
                    
                    <p style="text-align: center; font-family: monospace; background: #f8f9fa; padding: 1rem; border: 1px solid #ddd; margin: 1rem 2rem;"><strong>${walletAddress}</strong></p>
                    
                    <p><strong>Current Digital Asset Inventory (as of ${currentDate}):</strong></p>
                    <div style="margin-left: 2rem; background: #f8f9fa; padding: 1rem; border-left: 4px solid #007bff;">
                        ${Object.values(selectedAssets).map(asset => `
                            <p style="margin: 0.5rem 0;">• <strong>${asset.balance} ${asset.symbol}</strong> - Estimated Value: <strong>${asset.value}</strong></p>
                        `).join('')}
                        <p style="border-top: 1px solid #ddd; padding-top: 0.5rem; margin-top: 1rem; font-weight: bold;">Total Estimated Portfolio Value: ${totalValue.toLocaleString()}</p>
                    </div>
                    
                    <p><strong>Asset Distribution:</strong></p>
                    <div style="margin-left: 2rem;">
                        ${beneficiaryData.map((beneficiary, index) => `
                            <p><strong>${index + 1}.</strong> To <strong>${beneficiary.name}</strong>${beneficiary.relationship ? ` (my ${beneficiary.relationship})` : ''}, with digital wallet address:</p>
                            <p style="font-family: monospace; margin-left: 2rem; background: #f8f9fa; padding: 0.5rem; border: 1px solid #ddd;">${beneficiary.address}</p>
                            <p style="margin-left: 2rem;">I hereby bequeath <strong>${beneficiary.allocation}% (${beneficiary.allocation} percent)</strong> of all digital assets described herein, including any future appreciation, forks, airdrops, or derivative assets.</p>
                        `).join('')}
                    </div>
                </div>

                <div class="article">
                    <div class="article-title">ARTICLE III - APPOINTMENT OF EXECUTOR AND DIGITAL ASSET POWERS</div>
                    <p>I hereby nominate, constitute, and appoint <strong>${executorName}</strong>${executorAddress ? `, of ${executorAddress},` : ''} as the Executor of this Last Will and Testament. If ${executorName} is unable, unwilling, or fails to qualify as Executor, I nominate and appoint <strong>${witness1}</strong> as successor Executor.</p>
                    
                    <p><strong>Digital Asset Authority:</strong> I specifically grant my Executor the following powers and authorities with respect to my digital assets:</p>
                    <div style="margin-left: 2rem;">
                        <p><strong>a)</strong> To locate, access, and take control of all digital wallets, private keys, seed phrases, passwords, and authentication methods necessary to access my digital assets;</p>
                        <p><strong>b)</strong> To engage qualified blockchain technology experts, cryptocurrency services, or digital asset custodians as necessary;</p>
                        <p><strong>c)</strong> To convert digital assets to fiat currency if required for estate settlement or tax obligations;</p>
                        <p><strong>d)</strong> To create new digital wallets and transfer assets to beneficiaries' designated addresses;</p>
                        <p><strong>e)</strong> To claim any forks, airdrops, staking rewards, or other derivative benefits;</p>
                        <p><strong>f)</strong> To pay all taxes, fees, and expenses related to digital asset management and transfer;</p>
                        <p><strong>g)</strong> To execute all necessary documents and transactions to effectuate the distribution of digital assets.</p>
                    </div>
                </div>

                <div class="article">
                    <div class="article-title">ARTICLE IV - DIGITAL ASSET ADMINISTRATION INSTRUCTIONS</div>
                    <p><strong>Immediate Actions Required:</strong></p>
                    <div style="margin-left: 2rem;">
                        <p><strong>1. Security:</strong> My Executor shall immediately secure all digital assets by obtaining control of private keys and changing passwords to prevent unauthorized access;</p>
                        <p><strong>2. Inventory:</strong> Conduct a complete inventory and valuation of all digital assets within thirty (30) days of my death;</p>
                        <p><strong>3. Documentation:</strong> Maintain detailed records of all digital asset transactions, including blockchain transaction IDs;</p>
                        <p><strong>4. Distribution:</strong> Transfer assets to beneficiaries within ninety (90) days unless additional time is required for tax or legal compliance;</p>
                        <p><strong>5. Tax Compliance:</strong> Ensure all federal, state, and local tax obligations are satisfied before final distribution.</p>
                    </div>
                    
                    <p><strong>Technical Considerations:</strong></p>
                    <div style="margin-left: 2rem;">
                        <p>• All transfers must be verified on the respective blockchain networks before consideration as complete;</p>
                        <p>• Gas fees and transaction costs shall be paid from the estate before distribution;</p>
                        <p>• If any beneficiary's wallet address is invalid or inaccessible, the Executor may establish alternative secure transfer methods;</p>
                        <p>• Lost or inaccessible assets shall be distributed proportionally among remaining accessible assets.</p>
                    </div>
                    
                    ${notes ? `<p><strong>Special Instructions:</strong></p><div style="margin-left: 2rem; background: #fff3cd; padding: 1rem; border-left: 4px solid #ffc107;"><p>${notes}</p></div>` : ''}
                </div>

                <div class="article">
                    <div class="article-title">ARTICLE V - GENERAL PROVISIONS AND GOVERNING LAW</div>
                    <p><strong>Governing Law:</strong> This Will shall be construed and administered according to the laws of the state of my domicile at the time of my death, without regard to conflict of laws principles.</p>
                    
                    <p><strong>Severability:</strong> If any provision of this Will is held to be invalid or unenforceable, such determination shall not affect the validity or enforceability of the remaining provisions, which shall continue in full force and effect.</p>
                    
                    <p><strong>Digital Asset Definition:</strong> "Digital assets" as used herein includes cryptocurrency, virtual currency, digital tokens, non-fungible tokens (NFTs), blockchain-based assets, smart contracts, and any other form of digital property that exists on a blockchain or distributed ledger.</p>
                    
                    <p><strong>No Contest Clause:</strong> If any beneficiary contests this Will or any of its provisions, that beneficiary shall forfeit any interest in my estate.</p>
                    
                    <p><strong>Simultaneous Death:</strong> If any beneficiary and I die under circumstances where it is difficult to determine who died first, it shall be presumed that the beneficiary predeceased me.</p>
                </div>

                <div class="signature-section">
                    <p style="margin-bottom: 2rem;"><strong>IN WITNESS WHEREOF,</strong> I have signed my name to this Last Will and Testament consisting of <strong>___</strong> pages, including this page, this <strong>_____</strong> day of <strong>_______________</strong>, 20<strong>____</strong>, and declare that I do so freely, for the purposes expressed herein, and that I am of sound mind and under no constraint or undue influence.</p>
                    
                    <div style="margin: 3rem 0;">
                        <div class="signature-line">
                            <span style="margin-right: 3rem;">TESTATOR:</span>
                        </div>
                        <p style="text-align: center; margin-top: 0.5rem; font-weight: bold;">${testatorName}</p>
                        <p style="text-align: center; font-size: 0.9rem;">(Signature)</p>
                    </div>

                    <div style="margin: 4rem 0;">
                        <p style="font-weight: bold; margin-bottom: 1rem;">ATTESTATION OF WITNESSES</p>
                        <p>Each of us declares under penalty of perjury that the following is true and correct:</p>
                        <div style="margin-left: 1rem;">
                            <p>a) The testator signed this Will in our presence;</p>
                            <p>b) The testator appeared to be of sound mind and under no duress;</p>
                            <p>c) We signed as witnesses in the testator's presence and in each other's presence;</p>
                            <p>d) Each of us is over 18 years of age;</p>
                            <p>e) Neither of us is a beneficiary of this Will.</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                            <div>
                                <div class="signature-line" style="margin-bottom: 0.5rem;">
                                    <span>WITNESS 1:</span>
                                </div>
                                <p style="font-weight: bold; margin-bottom: 0.25rem;">${witness1}</p>
                                <p style="font-size: 0.9rem; margin-bottom: 1rem;">(Print Name)</p>
                                <p style="border-bottom: 1px solid #333; margin-bottom: 0.25rem; min-height: 1.5rem;"></p>
                                <p style="font-size: 0.9rem; margin-bottom: 1rem;">(Address)</p>
                                <p>Date: <span class="date-line" style="border-bottom: 1px solid #333; display: inline-block; width: 150px; margin-left: 1rem;"></span></p>
                            </div>
                            
                            <div>
                                <div class="signature-line" style="margin-bottom: 0.5rem;">
                                    <span>WITNESS 2:</span>
                                </div>
                                <p style="font-weight: bold; margin-bottom: 0.25rem;">${witness2}</p>
                                <p style="font-size: 0.9rem; margin-bottom: 1rem;">(Print Name)</p>
                                <p style="border-bottom: 1px solid #333; margin-bottom: 0.25rem; min-height: 1.5rem;"></p>
                                <p style="font-size: 0.9rem; margin-bottom: 1rem;">(Address)</p>
                                <p>Date: <span class="date-line" style="border-bottom: 1px solid #333; display: inline-block; width: 150px; margin-left: 1rem;"></span></p>
                            </div>
                        </div>
                    </div>

                    <div style="margin: 4rem 0; border: 3px solid #000; padding: 2rem;">
                        <p style="text-align: center; font-weight: bold; font-size: 1.2rem; margin-bottom: 1.5rem;">NOTARIAL ACKNOWLEDGMENT</p>
                        
                        <div style="margin-bottom: 1rem;">
                            <p>State of: <span style="border-bottom: 1px solid #000; display: inline-block; width: 200px; margin-left: 1rem;"></span></p>
                            <p>County of: <span style="border-bottom: 1px solid #000; display: inline-block; width: 200px; margin-left: 1rem;"></span></p>
                        </div>
                        
                        <p style="margin: 1.5rem 0; line-height: 1.8;">On this <span style="border-bottom: 1px solid #000; display: inline-block; width: 50px; text-align: center;"></span> day of <span style="border-bottom: 1px solid #000; display: inline-block; width: 120px; text-align: center;"></span>, 20<span style="border-bottom: 1px solid #000; display: inline-block; width: 40px; text-align: center;"></span>, before me, <span style="border-bottom: 1px solid #000; display: inline-block; width: 200px; text-align: center;"></span>, a Notary Public in and for said State, personally appeared <strong>${testatorName}</strong>, who proved to me on the basis of satisfactory evidence to be the person whose name is subscribed to the within instrument and acknowledged to me that he/she executed the same in his/her authorized capacity, and that by his/her signature on the instrument the person, or the entity upon behalf of which the person acted, executed the instrument.</p>
                        
                        <p style="margin: 1.5rem 0;">I certify under <strong>PENALTY OF PERJURY</strong> under the laws of the State of <span style="border-bottom: 1px solid #000; display: inline-block; width: 100px; text-align: center;"></span> that the foregoing paragraph is true and correct.</p>
                        
                        <p style="margin: 1.5rem 0;"><strong>WITNESS</strong> my hand and official seal.</p>
                        
                        <div style="margin: 3rem 0; display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <div style="border-bottom: 2px solid #000; height: 60px; display: flex; align-items: end; padding-bottom: 0.5rem;">
                                    <span style="font-size: 0.9rem;">(Signature of Notary Public)</span>
                                </div>
                            </div>
                            <div style="border: 2px solid #000; height: 80px; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                                <span style="font-weight: bold; text-align: center;">NOTARY SEAL<br/><span style="font-size: 0.8rem;">(Affix Official Seal Above)</span></span>
                            </div>
                        </div>
                        
                        <p style="font-size: 0.9rem; margin-top: 1rem;">My commission expires: <span style="border-bottom: 1px solid #000; display: inline-block; width: 150px; margin-left: 1rem;"></span></p>
                    </div>
                </div>
            `;

            // Display the document
            document.getElementById('legal-document').innerHTML = legalDocument;
            document.getElementById('legal-document-section').classList.remove('hidden');

            // Show success message
            const successMessage = document.createElement('div');
            successMessage.className = 'status-message status-success';
            successMessage.innerHTML = `
                <strong>✅ Legal Will Generated Successfully!</strong><br/>
                Your digital asset will has been created with ${Object.keys(selectedAssets).length} assets worth approximately ${totalValue.toLocaleString()}. 
                Please review all details carefully before printing and notarization.
            `;
            
            const documentSection = document.getElementById('legal-document-section');
            documentSection.insertBefore(successMessage, documentSection.firstChild);

            // Scroll to document
            setTimeout(() => {
                document.getElementById('legal-document-section').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 100);
        }

        // Print will function - SIMPLIFIED AND RELIABLE
        function printWill() {
            console.log('🖨️ Print function called');
            
            const documentContent = document.getElementById('legal-document');
            if (!documentContent) {
                alert('⚠️ Please generate the will document first!');
                return;
            }
            
            // Simple direct print approach
            const originalContent = document.body.innerHTML;
            const printContent = `
                <html>
                <head>
                    <title>Digital Asset Will</title>
                    <style>
                        body { font-family: 'Times New Roman', serif; font-size: 12pt; line-height: 1.6; margin: 1in; }
                        h1 { text-align: center; text-decoration: underline; }
                        .article { margin-bottom: 20pt; }
                        .article-title { font-weight: bold; text-decoration: underline; margin-bottom: 10pt; }
                        .signature-line { border-bottom: 1px solid black; margin: 15pt 0; min-height: 30pt; }
                        p { margin-bottom: 10pt; }
                    </style>
                </head>
                <body>${documentContent.innerHTML}</body>
                </html>
            `;
            
            // Replace body content temporarily
            document.body.innerHTML = printContent;
            
            // Print
            window.print();
            
            // Restore original content
            setTimeout(() => {
                document.body.innerHTML = originalContent;
                
                // Re-bind events after restoring content
                document.getElementById('will-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    generateSimpleWill();
                });
                
                console.log('✅ Print completed, page restored');
            }, 1000);
        }

        // Download will function - FIXED VERSION  
        function downloadWill() {
            console.log('💾 Starting download process...');
            
            const testatorName = document.getElementById('testator-name').value.trim() || 'John_Doe';
            const currentDate = new Date().toISOString().split('T')[0];
            const filename = `Digital_Asset_Will_${testatorName.replace(/\s+/g, '_')}_${currentDate}.html`;
            
            const documentContent = document.getElementById('legal-document');
            if (!documentContent) {
                alert('⚠️ Please generate the will document first!');
                return;
            }
            
            const downloadHTML = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Asset Will - ${testatorName}</title>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            color: #333;
            background: white;
            max-width: 8.5in;
            margin: 0 auto;
            padding: 1in;
        }
        
        .legal-document {
            border: 2px solid #333;
            padding: 2rem;
            background: white;
        }
        
        h1 {
            text-align: center;
            text-transform: uppercase;
            font-size: 1.5rem;
            margin-bottom: 2rem;
            text-decoration: underline;
        }
        
        .article {
            margin-bottom: 2rem;
        }
        
        .article-title {
            font-weight: bold;
            text-decoration: underline;
            margin-bottom: 1rem;
        }
        
        .signature-section {
            margin-top: 3rem;
            border-top: 1px solid #333;
            padding-top: 2rem;
        }
        
        .signature-line {
            border-bottom: 1px solid #333;
            margin: 2rem 0;
            padding-bottom: 0.5rem;
            min-height: 3rem;
        }
        
        .date-line {
            border-bottom: 1px solid #333;
            width: 200px;
            display: inline-block;
            margin: 0 1rem;
        }
        
        @media print {
            @page {
                size: letter;
                margin: 1in;
            }
            body { 
                font-size: 12pt;
                line-height: 1.5;
                margin: 0;
                padding: 0;
            }
            .legal-document { 
                border: 2px solid black;
                page-break-inside: avoid;
            }
        }
        
        .download-info {
            background: #e3f2fd;
            padding: 1rem;
            margin-bottom: 2rem;
            border-left: 4px solid #2196f3;
            border-radius: 5px;
        }
        
        .print-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 5px;
        }
        
        @media print {
            .download-info, .print-button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="download-info">
        <h3>📄 Digital Asset Will Document</h3>
        <p><strong>Generated:</strong> ${new Date().toLocaleDateString()}</p>
        <p><strong>For:</strong> ${testatorName}</p>
        <button class="print-button" onclick="window.print()">🖨️ Print for Notarization</button>
        <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
            <strong>Instructions:</strong> Print this document, sign in front of witnesses and a notary public. 
            Keep the original in a secure location and provide copies to your executor.
        </p>
    </div>
    
    <div class="legal-document">
        ${documentContent.innerHTML}
    </div>
</body>
</html>`;

            // Create download
            const blob = new Blob([downloadHTML], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            // Create download link
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.style.display = 'none';
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Clean up
            URL.revokeObjectURL(url);
            
            // Success notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                z-index: 10000;
                max-width: 300px;
                font-family: Arial, sans-serif;
            `;
            notification.innerHTML = `
                <strong>✅ Download Complete!</strong><br>
                File: ${filename}<br>
                📁 Check your Downloads folder
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 4000);
            
            console.log('✅ Download completed:', filename);
        }

        // Simple will generation function that bypasses complex validation
        function generateSimpleWill() {
            console.log('🚀 Starting will generation...');
            
            // Get basic form data with defaults
            const testatorName = document.getElementById('testator-name').value.trim() || 'John Doe';
            const testatorAddress = document.getElementById('testator-address').value.trim() || '123 Main St, City, State 12345';
            const executorName = document.getElementById('executor-name').value.trim() || 'Jane Smith';
            const witness1 = document.getElementById('witness1-name').value.trim() || 'Witness One';
            const witness2 = document.getElementById('witness2-name').value.trim() || 'Witness Two';
            const walletAddress = document.getElementById('wallet-address').value.trim() || '0x742d35Cc6634C0532925a3b8d404d29cf37e97f1';
            
            // Use current assets or mock data
            let assetsToUse = currentAssets.length > 0 ? currentAssets : mockAssets;
            console.log('📊 Using assets:', assetsToUse);
            
            // Get beneficiaries
            const beneficiaries = document.querySelectorAll('.beneficiary-item');
            let beneficiaryData = [];
            
            beneficiaries.forEach((beneficiary, index) => {
                const name = beneficiary.querySelector('input[name="beneficiary-name"]').value.trim() || `Beneficiary ${index + 1}`;
                const address = beneficiary.querySelector('input[name="beneficiary-address"]').value.trim() || '0x1234567890123456789012345678901234567890';
                const allocation = beneficiary.querySelector('select[name="allocation"]').value || '100';
                
                beneficiaryData.push({ name, address, allocation });
            });
            
            if (beneficiaryData.length === 0) {
                beneficiaryData = [{ name: 'Primary Beneficiary', address: '0x1234567890123456789012345678901234567890', allocation: '100' }];
            }
            
            console.log('👥 Beneficiaries:', beneficiaryData);
            
            // Calculate total value
            const totalValue = assetsToUse.reduce((sum, asset) => {
                const value = parseFloat(asset.value.replace(/[$,]/g, '')) || 0;
                return sum + value;
            }, 0);
            
            const currentDate = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Generate the legal document
            const legalDocument = `
                <h1>Last Will and Testament of ${testatorName}</h1>
                
                <div class="article">
                    <div class="article-title">ARTICLE I - DECLARATION AND REVOCATION</div>
                    <p>I, <strong>${testatorName}</strong>, a resident of <strong>${testatorAddress}</strong>, being of sound mind and memory and not acting under duress, menace, fraud, or undue influence of any person whomsoever, do hereby make, publish, and declare this instrument to be my Last Will and Testament, hereby expressly revoking all wills and codicils heretofore made by me.</p>
                    
                    <p>I am over the age of eighteen (18) years and am competent to make this Will. I declare that this Will expresses my true wishes concerning the disposition of my digital assets and that I have carefully read this Will and understand its contents.</p>
                </div>

                <div class="article">
                    <div class="article-title">ARTICLE II - DIGITAL ASSET IDENTIFICATION AND DISPOSITION</div>
                    <p>I hereby give, devise, and bequeath all of my right, title, and interest in and to my digital assets, including but not limited to cryptocurrency, digital tokens, non-fungible tokens (NFTs), smart contracts, and other blockchain-based assets, currently held in or accessible through the digital wallet with address:</p>
                    
                    <p style="text-align: center; font-family: monospace; background: #f8f9fa; padding: 1rem; border: 1px solid #ddd; margin: 1rem 2rem;"><strong>${walletAddress}</strong></p>
                    
                    <p><strong>Current Digital Asset Inventory (as of ${currentDate}):</strong></p>
                    <div style="margin-left: 2rem; background: #f8f9fa; padding: 1rem; border-left: 4px solid #007bff;">
                        ${assetsToUse.map(asset => `
                            <p style="margin: 0.5rem 0;">• <strong>${asset.balance} ${asset.symbol}</strong> - Estimated Value: <strong>${asset.value}</strong></p>
                        `).join('')}
                        <p style="border-top: 1px solid #ddd; padding-top: 0.5rem; margin-top: 1rem; font-weight: bold;">Total Estimated Portfolio Value: ${totalValue.toLocaleString()}</p>
                    </div>
                    
                    <p><strong>Asset Distribution:</strong></p>
                    <div style="margin-left: 2rem;">
                        ${beneficiaryData.map((beneficiary, index) => `
                            <p><strong>${index + 1}.</strong> To <strong>${beneficiary.name}</strong>, with digital wallet address:</p>
                            <p style="font-family: monospace; margin-left: 2rem; background: #f8f9fa; padding: 0.5rem; border: 1px solid #ddd;">${beneficiary.address}</p>
                            <p style="margin-left: 2rem;">I hereby bequeath <strong>${beneficiary.allocation}% (${beneficiary.allocation} percent)</strong> of all digital assets described herein, including any future appreciation, forks, airdrops, or derivative assets.</p>
                        `).join('')}
                    </div>
                </div>

                <div class="article">
                    <div class="article-title">ARTICLE III - APPOINTMENT OF EXECUTOR AND DIGITAL ASSET POWERS</div>
                    <p>I hereby nominate, constitute, and appoint <strong>${executorName}</strong> as the Executor of this Last Will and Testament. If ${executorName} is unable, unwilling, or fails to qualify as Executor, I nominate and appoint <strong>${witness1}</strong> as successor Executor.</p>
                    
                    <p><strong>Digital Asset Authority:</strong> I specifically grant my Executor the following powers and authorities with respect to my digital assets:</p>
                    <div style="margin-left: 2rem;">
                        <p><strong>a)</strong> To locate, access, and take control of all digital wallets, private keys, seed phrases, passwords, and authentication methods necessary to access my digital assets;</p>
                        <p><strong>b)</strong> To engage qualified blockchain technology experts, cryptocurrency services, or digital asset custodians as necessary;</p>
                        <p><strong>c)</strong> To convert digital assets to fiat currency if required for estate settlement or tax obligations;</p>
                        <p><strong>d)</strong> To create new digital wallets and transfer assets to beneficiaries' designated addresses;</p>
                        <p><strong>e)</strong> To claim any forks, airdrops, staking rewards, or other derivative benefits;</p>
                        <p><strong>f)</strong> To pay all taxes, fees, and expenses related to digital asset management and transfer;</p>
                        <p><strong>g)</strong> To execute all necessary documents and transactions to effectuate the distribution of digital assets.</p>
                    </div>
                </div>

                <div class="article">
                    <div class="article-title">ARTICLE IV - DIGITAL ASSET ADMINISTRATION INSTRUCTIONS</div>
                    <p><strong>Immediate Actions Required:</strong></p>
                    <div style="margin-left: 2rem;">
                        <p><strong>1. Security:</strong> My Executor shall immediately secure all digital assets by obtaining control of private keys and changing passwords to prevent unauthorized access;</p>
                        <p><strong>2. Inventory:</strong> Conduct a complete inventory and valuation of all digital assets within thirty (30) days of my death;</p>
                        <p><strong>3. Documentation:</strong> Maintain detailed records of all digital asset transactions, including blockchain transaction IDs;</p>
                        <p><strong>4. Distribution:</strong> Transfer assets to beneficiaries within ninety (90) days unless additional time is required for tax or legal compliance;</p>
                        <p><strong>5. Tax Compliance:</strong> Ensure all federal, state, and local tax obligations are satisfied before final distribution.</p>
                    </div>
                    
                    ${notes ? `
                    <p style="margin-top: 2rem;"><strong>SPECIAL INSTRUCTIONS AND ADDITIONAL WISHES:</strong></p>
                    <div style="margin: 1rem 2rem; background: #fff3cd; padding: 1.5rem; border-left: 4px solid #ffc107; border-radius: 5px;">
                        <p style="margin: 0; line-height: 1.8; font-style: italic;">"${notes}"</p>
                    </div>
                    <p style="margin-left: 2rem;">I direct my Executor to carefully consider and implement these additional instructions to the extent legally permissible and practically feasible. These instructions are an integral part of my wishes for the administration of my digital assets.</p>
                    ` : `
                    <p style="margin-top: 2rem;"><strong>SPECIAL INSTRUCTIONS AND ADDITIONAL WISHES:</strong></p>
                    <div style="margin: 1rem 2rem; background: #f8f9fa; padding: 1rem; border-left: 4px solid #6c757d; border-radius: 5px;">
                        <p style="margin: 0; font-style: italic; color: #6c757d;">No additional special instructions provided by the testator.</p>
                    </div>
                    `}
                </div>

                <div class="article">
                    <div class="article-title">ARTICLE V - GENERAL PROVISIONS AND GOVERNING LAW</div>
                    <p><strong>Governing Law:</strong> This Will shall be construed and administered according to the laws of the state of my domicile at the time of my death, without regard to conflict of laws principles.</p>
                    
                    <p><strong>Severability:</strong> If any provision of this Will is held to be invalid or unenforceable, such determination shall not affect the validity or enforceability of the remaining provisions, which shall continue in full force and effect.</p>
                    
                    <p><strong>Digital Asset Definition:</strong> "Digital assets" as used herein includes cryptocurrency, virtual currency, digital tokens, non-fungible tokens (NFTs), blockchain-based assets, smart contracts, and any other form of digital property that exists on a blockchain or distributed ledger.</p>
                </div>

                <div class="signature-section">
                    <p style="margin-bottom: 2rem;"><strong>IN WITNESS WHEREOF,</strong> I have signed my name to this Last Will and Testament this <strong>_____</strong> day of <strong>_______________</strong>, 20<strong>____</strong>.</p>
                    
                    <div style="margin: 3rem 0;">
                        <div class="signature-line">
                            <span style="margin-right: 3rem;">TESTATOR:</span>
                        </div>
                        <p style="text-align: center; margin-top: 0.5rem; font-weight: bold;">${testatorName}</p>
                        <p style="text-align: center; font-size: 0.9rem;">(Signature)</p>
                    </div>

                    <div style="margin: 4rem 0;">
                        <p style="font-weight: bold; margin-bottom: 1rem;">ATTESTATION OF WITNESSES</p>
                        <p>Each of us declares under penalty of perjury that the following is true and correct:</p>
                        <div style="margin-left: 1rem;">
                            <p>a) The testator signed this Will in our presence;</p>
                            <p>b) The testator appeared to be of sound mind and under no duress;</p>
                            <p>c) We signed as witnesses in the testator's presence and in each other's presence;</p>
                            <p>d) Each of us is over 18 years of age;</p>
                            <p>e) Neither of us is a beneficiary of this Will.</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                            <div>
                                <div class="signature-line" style="margin-bottom: 0.5rem;">
                                    <span>WITNESS 1:</span>
                                </div>
                                <p style="font-weight: bold; margin-bottom: 0.25rem;">${witness1}</p>
                                <p style="font-size: 0.9rem; margin-bottom: 1rem;">(Print Name)</p>
                                <p style="border-bottom: 1px solid #333; margin-bottom: 0.25rem; min-height: 1.5rem;"></p>
                                <p style="font-size: 0.9rem; margin-bottom: 1rem;">(Address)</p>
                                <p>Date: <span class="date-line" style="border-bottom: 1px solid #333; display: inline-block; width: 150px; margin-left: 1rem;"></span></p>
                            </div>
                            
                            <div>
                                <div class="signature-line" style="margin-bottom: 0.5rem;">
                                    <span>WITNESS 2:</span>
                                </div>
                                <p style="font-weight: bold; margin-bottom: 0.25rem;">${witness2}</p>
                                <p style="font-size: 0.9rem; margin-bottom: 1rem;">(Print Name)</p>
                                <p style="border-bottom: 1px solid #333; margin-bottom: 0.25rem; min-height: 1.5rem;"></p>
                                <p style="font-size: 0.9rem; margin-bottom: 1rem;">(Address)</p>
                                <p>Date: <span class="date-line" style="border-bottom: 1px solid #333; display: inline-block; width: 150px; margin-left: 1rem;"></span></p>
                            </div>
                        </div>
                    </div>

                    <div style="margin: 4rem 0; border: 3px solid #000; padding: 2rem;">
                        <p style="text-align: center; font-weight: bold; font-size: 1.2rem; margin-bottom: 1.5rem;">NOTARIAL ACKNOWLEDGMENT</p>
                        
                        <div style="margin-bottom: 1rem;">
                            <p>State of: <span style="border-bottom: 1px solid #000; display: inline-block; width: 200px; margin-left: 1rem;"></span></p>
                            <p>County of: <span style="border-bottom: 1px solid #000; display: inline-block; width: 200px; margin-left: 1rem;"></span></p>
                        </div>
                        
                        <p style="margin: 1.5rem 0; line-height: 1.8;">On this <span style="border-bottom: 1px solid #000; display: inline-block; width: 50px; text-align: center;"></span> day of <span style="border-bottom: 1px solid #000; display: inline-block; width: 120px; text-align: center;"></span>, 20<span style="border-bottom: 1px solid #000; display: inline-block; width: 40px; text-align: center;"></span>, before me personally appeared <strong>${testatorName}</strong>, who proved to me on the basis of satisfactory evidence to be the person whose name is subscribed to the within instrument and acknowledged to me that he/she executed the same in his/her authorized capacity.</p>
                        
                        <p style="margin: 1.5rem 0;">I certify under <strong>PENALTY OF PERJURY</strong> under the laws of the State of <span style="border-bottom: 1px solid #000; display: inline-block; width: 100px; text-align: center;"></span> that the foregoing paragraph is true and correct.</p>
                        
                        <div style="margin: 3rem 0; display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <div style="border-bottom: 2px solid #000; height: 60px; display: flex; align-items: end; padding-bottom: 0.5rem;">
                                    <span style="font-size: 0.9rem;">(Signature of Notary Public)</span>
                                </div>
                            </div>
                            <div style="border: 2px solid #000; height: 80px; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                                <span style="font-weight: bold; text-align: center;">NOTARY SEAL<br/><span style="font-size: 0.8rem;">(Affix Official Seal Above)</span></span>
                            </div>
                        </div>
                        
                        <p style="font-size: 0.9rem; margin-top: 1rem;">My commission expires: <span style="border-bottom: 1px solid #000; display: inline-block; width: 150px; margin-left: 1rem;"></span></p>
                    </div>
                </div>
            `;

            console.log('📄 Document generated, updating DOM...');
            
            // Update the document
            document.getElementById('legal-document').innerHTML = legalDocument;
            document.getElementById('legal-document-section').classList.remove('hidden');

            // Add success message
            const existingMessage = document.querySelector('.legal-document-container .status-message');
            if (existingMessage) existingMessage.remove();
            
            const successMessage = document.createElement('div');
            successMessage.className = 'status-message status-success';
            successMessage.innerHTML = `
                <strong>✅ Legal Will Generated Successfully!</strong><br/>
                Your digital asset will has been created with ${assetsToUse.length} assets worth approximately ${totalValue.toLocaleString()}. 
                This document is ready for printing and notarization.
            `;
            
            const documentSection = document.getElementById('legal-document-section');
            documentSection.insertBefore(successMessage, documentSection.firstChild);

            console.log('🎉 Will generation complete!');

            // Scroll to document
            setTimeout(() => {
                document.getElementById('legal-document-section').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 100);
        }

        // Form submission handler with better debugging
        document.getElementById('will-form').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('🎯 Form submit button clicked!');
            
            // Just generate the will without complex validation
            generateSimpleWill();
        });

        // Add direct button click handler as backup
        document.addEventListener('DOMContentLoaded', function() {
            const submitBtn = document.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('🔘 Direct button click detected!');
                    generateSimpleWill();
                });
            }
        });

        // Enter key handler for wallet address
        document.getElementById('wallet-address').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                fetchAssetsFromEtherscan();
            }
        });

        // Auto-load demo data for testing
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (currentAssets.length === 0) {
                    useMockData();
                }
            }, 500);
        });
    </script>
</body>
</html>
    </script>
</body>
</html>